%PA calibration global background
%2	100	1258.357143	944.5017007;...
%mmax = 40000 for kVp=39, 7000 for 26kVp [5 5] median filter
%{
2	0	13168.52459	11354.40028;...
2	30	15110.30631	12769.56348;...
2	45	16065.64167	13451.33716;...
2	50	16451.71254	13701.79529;...
2	60	17207.39914	14211.64354;...
2	70	17807.63883	14616.97336;...
2	100	19951.97482	16117.87807;...
3	0	18933.50357	15723.61029;...
3	30	21617.61982	17485.31041;...
3	45	22919.00669	18323.64402;...
3	50	23448.59117	18628.92633;...
3	60	24529.87476	19295.27214;...
3	70	25412.1347	19826.12705;...
3	100	28399.14472	21656.99654;...
%}
Data=[...
3	0	18933.50357	15723.61029;...
3	30	21617.61982	17485.31041;...
3	45	22919.00669	18323.64402;...
3	50	23448.59117	18628.92633;...
3	60	24529.87476	19295.27214;...
3	70	25412.1347	19826.12705;...
3	100	28399.14472	21656.99654;...
4	0	24975.5472	20102.15636;...
4	30	28385.15721	22060.54727;...
4	45	29994.05043	22992.23388;...
4	50	30625.36127	23335.64076;...
4	60	31996.11383	24139.53309;...
4	70	33111.1562	24772.25924;...
4	100	36794.99124	26788.58438;...
5	0	30222.22965	24175.11483;...
5	30	34123.13197	26479.6453;...
5	45	35930.76161	27434.5003;...
5	50	36644.66897	27839.31649;...
5	60	38239.12843	28763.55513;...
5	70	39533.87355	29527.60771;...
5	100	43881.39594	31882.16277;...
];

Data(:,3)=Data(:,3)/1000;
Data(:,4)=Data(:,4)/1000;
Data(:,3)=Data(:,3)./Data(:,4);
B=[Data(:,1) Data(:,2)];
A=[ones(size(Data,1),1) Data(:,3) Data(:,4) Data(:,3).^2 Data(:,4).^2 Data(:,3).*Data(:,4)];
X=A\B

Result=A*X
figure;plot(Result(:,2),'o');hold on;
plot(Data(:,2),'rx');

dev_thickness = (sum((Data(:,1)-Result(:,1)).^2)./size(Data,1)).^0.5
dev_density = (sum((Data(:,2)-Result(:,2)).^2)./size(Data,1)).^0.5
%dev = (sum((Data(:,2)-Result(:,2)).^2)./size(Data,1)).^0.5
;




